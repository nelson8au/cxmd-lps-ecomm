{extend name="../../common/view/main"/}
{block name="style"}
<link href="__STATIC__/ucenter/css/main.min.css" rel="stylesheet">
<link rel="stylesheet" href="__STATIC__/ucenter/lib/paging/my-page.css">
<style>
  .address-lists .px-2 {
    padding-left: 1rem;
    padding-right: 1rem;
  }

  .address-lists .pt-3 {
    padding-top: 1.5rem;
  }

  .address-lists .pt-5 {
    padding-top: 3rem;
  }

  .address-lists .address-card {
    position: relative;
    display: flex;
    flex-direction: column;
    min-width: 0;
    word-wrap: break-word;
    padding: 10px;
    background: repeating-linear-gradient(-50deg, #E7E7E7 0, #E7E7E7 1em, transparent 1em, transparent calc(1em* 2), #E7E7E7 calc(1em* 2), #E7E7E7 calc(1em* 3), transparent calc(1em* 3), transparent calc(1em* 4)) top, repeating-linear-gradient(-50deg, #E7E7E7 0, #E7E7E7 1em, transparent 1em, transparent calc(1em* 2), #E7E7E7 calc(1em* 2), #E7E7E7 calc(1em* 3), transparent calc(1em* 3), transparent calc(1em* 4)) bottom, repeating-linear-gradient(-25deg, #E7E7E7 0, #E7E7E7 1em, transparent 1em, transparent calc(1em* 2), #E7E7E7 calc(1em* 2), #E7E7E7 calc(1em* 3), transparent calc(1em* 3), transparent calc(1em* 4)) left, repeating-linear-gradient(-25deg, #E7E7E7 0, #E7E7E7 1em, transparent 1em, transparent calc(1em* 2), #E7E7E7 calc(1em* 2), #E7E7E7 calc(1em* 3), transparent calc(1em* 3), transparent calc(1em* 4)) right;
    background-size: 100% 3px, 100% 3px, 3px 100%, 3px 100%;
    background-repeat: no-repeat;
    border: none;
  }

  .address-lists .address-card.isDefault1 {
    background: repeating-linear-gradient(-50deg, #F8534B 0, #F8534B 1em, transparent 1em, transparent calc(1em* 2), #4861E7 calc(1em* 2), #4861E7 calc(1em* 3), transparent calc(1em* 3), transparent calc(1em* 4)) top, repeating-linear-gradient(-50deg, #F8534B 0, #F8534B 1em, transparent 1em, transparent calc(1em* 2), #4861E7 calc(1em* 2), #4861E7 calc(1em* 3), transparent calc(1em* 3), transparent calc(1em* 4)) bottom, repeating-linear-gradient(-25deg, #F8534B 0, #F8534B 1em, transparent 1em, transparent calc(1em* 2), #4861E7 calc(1em* 2), #4861E7 calc(1em* 3), transparent calc(1em* 3), transparent calc(1em* 4)) left, repeating-linear-gradient(-25deg, #F8534B 0, #F8534B 1em, transparent 1em, transparent calc(1em* 2), #4861E7 calc(1em* 2), #4861E7 calc(1em* 3), transparent calc(1em* 3), transparent calc(1em* 4)) right;
    background-size: 100% 3px, 100% 3px, 3px 100%, 3px 100%;
    background-repeat: no-repeat;
    border: none;
  }

  .address-lists .row {
    display: flex;
    flex-wrap: wrap;
    margin-top: calc(var(--bs-gutter-y) * -1);
    margin-right: calc(var(--bs-gutter-x) * -.5);
    margin-left: calc(var(--bs-gutter-x) * -.5);
  }

  .address-lists .btn-carnation {
    background: #58af2c;
    background-color: #58af2c;
    color: #fff;
  }

  .text-royal-blue {
    color: #4861E7;
  }

  .content-end {
    display: flex;
    justify-content: end;
  }

  .default-address-sign {
    border: 1px solid #58af2c;
    width: fit-content;
    padding: 0px 10px;
    border-radius: 5px;
    color: #58af2c;
  }
</style>
{/block}
{block name="body"}

<div id="main-container" class="user-config">
  <div class="container-fixed clearfix">
    <div class="left-slide">
      {include file="common/_slide"/}
    </div>
    <div class="right-content">
      <div id="center" class="orders-lists address-lists">
        <h4 class="lists-title">My Address</h4>
        {notempty name="addresses"}
        <div class="addresses pt-5">
          {volist name="addresses" id="address"}
          <div class="pt-3">
            <div class="address-card isDefault{$address.first}">
              <div class="row">
                <div class="col-9">
                  <div class="row">
                    <div class="col-2">
                      <strong>{$address.name}</strong>
                    </div>
                    <div class="col-2">
                      <strong>{$address.pos_country}</strong>
                    </div>
                    <div class="col-4">
                      {$address.pos_province} <br> {$address.address}, {$address.postcode}
                    </div>
                    <div class="col-2">
                      {$address.phone_prefix}{$address.phone}
                    </div>
                    {if $address.first }
                    <div class="col-2">
                      <div class="default-address-sign">Default</div>
                    </div>
                    {/if}
                  </div>
                </div>
                <div class="col-3">
                  <div class="row">
                    <div class="col-12 content-end px-2">
                      <a href="{:url('ucenter/address/delete',['id'=>$address->id])}"
                        data-confirm="Are you sure you want to delete this?" class="ajax-get"><i
                          class="fa fa-times"></i></a>
                    </div>
                    <div class="col-12 content-end pt-3">
                      {if !$address.first }
                      <div class="px-2">
                        <a href="#" data-address-id="{$address.id}" data-uid="{$address.uid}"
                          class="set-default-button text-royal-blue">
                          Set as Default</a>
                      </div>
                      {/if}
                      <div class="px-2">
                        <a href="{:url('ucenter/address/edit',['id'=>$address->id])}" class="text-royal-blue"> Edit</a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          {/volist}
        </div>
        {/notempty}
        <div class="pt-5">
          <a href="{:url('ucenter/address/edit')}" class="btn btn-carnation">Add New Address</a>
        </div>
      </div>
    </div>
  </div>
</div>

{/block}

{block name="script"}
<script src="__STATIC__/ucenter/js/main.min.js"></script>
<script>
  $(function () {
    $("#{$tab}").addClass('active');

    const appHost = "{$appHost}";

    const logoutBtn = document.querySelector('.logout-btn');
    if (logoutBtn) {
      const logout = "{$logout}";
      if (logout && logout === '1') {
        logoutBtn.click();
      }
    }

    const setDeaultButtons = document.querySelectorAll('.set-default-button');
    if (setDeaultButtons) {
      setDeaultButtons.forEach(setDeaultButton => {
        setDeaultButton.addEventListener('click', function () {
          fetch(`${appHost}/ucenter/Address/default`, {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify({ id: setDeaultButton.dataset.addressId, uid: setDeaultButton.dataset.uid }),
          })
            .then((res) => res.json())
            .then((response) => {
              if (response.code !== 200) {
                alert(response.msg);
              } else {
                alert(response.msg);
                window.location.href = '/ucenter/address/lists.html';
              }
            })
            .catch((error) => {
              alert(error);
            });
        });
      });
    }
  });
</script>

{/block}