"use strict";!function(r,s,a){var l=function(a){a.url&&(a.msg+=", The page will redirect shortly~"),200==a.code?toast.success(a.msg,"success"):toast.error(a.msg,"danger");"refresh"==a.url?setTimeout(function(){location.reload()},1e3):a.url&&setTimeout(function(){location.href=a.url},1e3)},d=function(a,t){""==a&&(a="Are you sure you want to proceed with this operation?");var e='<div class="modal fade confirm-modal" id="tip_Modal"><div class="modal-dialog modal-tip"><div class="modal-content"><div class="modal-body">'+('<div class="text-center"><i class="fa fa-exclamation-circle"></i><p class="title">System Message</p><p class="desc">'+a+'</p><div class="text-center"><button class="btn btn-info confirm margin-right" type="button">Confirm</button><button type="button" class="btn" data-dismiss="modal">Cancel</button></div></div>')+"</div></div></div></div>";return 0==r("#tip_Modal").length&&r("body").append(e),r("#tip_Modal").modal("show"),r("#tip_Modal").off("click",".confirm"),r("#tip_Modal").on("click",".confirm",function(){"function"==typeof t&&t(),r('[data-dismiss="modal"]').click(),r("#tip_Modal").remove(),r(".modal-backdrop").remove()}),!1};r(document).ready(function(){r(document).on("click",".ajax-post",function(a){a.preventDefault();var i=r(this),t=r(this).attr("target-form");if(t){var e=r("."+t).serialize();if(""==e)return toast.error("Please select the target to operate on!","danger"),!1}var s=r(this).attr("href");if(r(this).attr("url")&&(s=r(this).attr("url")),r(this).attr("data-url")&&(s=r(this).attr("data-url")),r(this).attr("data-confirm")||r(this).hasClass("confirm")){var n=r(this).attr("data-confirm");n=n||"Are you sure you want to proceed with this operation?"}if(n)return d(n,function(){o()}),!1;function o(){i.addClass("disabled"),r.post(s,e,function(a,t,e){i.removeClass("disabled"),l(a)})}o()}),r(document).on("click",".ajax-get",function(a){a.preventDefault();var t=r(this),e=r(this).attr("target-form");if(e&&""==r("."+e).serialize())return toast.error("Please select the target to operate on!","danger"),!1;var i=r(this).attr("href");if(r(this).attr("url")&&(i=r(this).attr("url")),r(this).attr("data-url")&&(i=r(this).attr("data-url")),r(this).attr("data-confirm")||r(this).hasClass("confirm")){var s=r(this).attr("data-confirm");s=s||"Are you sure you want to proceed with this operation?"}if(s)return d(s,function(){n()}),!1;function n(){t.addClass("disabled"),r.get(i,function(a){t.removeClass("disabled"),l(a)})}n()}),r(document).on("submit","form.ajax-form",function(a){a.preventDefault();var t=r(this).attr("data-confirm"),i=r(this);if(""==i.serialize())return toast.hideLoading(),toast.error("Please select the target to operate on!","danger"),!1;if(t)return d(t,function(){e()}),!1;function e(){r("[type=submit]",i).addClass("disabled");var a=i.attr("action"),t=i.attr("method");a||(a=s.location.href),t||(t="get");var e=i.serialize();("post"==t?r.post:r.get)(a,e,function(a){l(a),r("[type=submit]",i).removeClass("disabled")})}return e(),!1})}),s.handle_ajax=l,s.modal_confirm=d}(jQuery,window);var admin_image={removeImage:function(a,t){this.upAttachVal("del",t,a),a.parents(".each").remove()},upAttachVal:function(a,t,e){var i=e.parents(".controls").find(".attach"),s=i.val().split(","),n=[];for(var o in s)""!==s[o]&&s[o]!==t.toString()&&n.push(s[o]);return"add"===a&&n.push(t),i.val(n.join(",")),n}};function isAndroid(){var a=navigator.userAgent;return(-1<a.indexOf("Android")||-1<a.indexOf("Linux"))&&void 0!==window.ShowFitness}function isIos(){var a=navigator.userAgent;return-1<a.indexOf("iPhone")||-1<a.indexOf("iOS")}$(function(){$(".check-all").click(function(){$(".ids").prop("checked",this.checked)}),$(".ids").click(function(){$(".ids").each(function(a){if(!this.checked)return $(".check-all").prop("checked",!1),!1;$(".check-all").prop("checked",!0)})}),$(".text").focus(function(){$(this).addClass("focus")}).blur(function(){$(this).removeClass("focus")}),$("textarea").focus(function(){$(this).closest(".textarea").addClass("focus")}).blur(function(){$(this).closest(".textarea").removeClass("focus")})}),$(function(){$('[data-rule="upgradeExpired"]').click(function(){new $.zui.Messager("The authorization has expired",{type:"default",placement:"center",icon:"info-sign",time:1e3}).show()})}),function(e,a,t){if(void 0===e)throw new Error("muu requires jQuery");e.muu||(e.muu=function(a){e.isPlainObject(a)&&e.extend(e.muu,a)}),a.toast={success:function(a){toast.show(a,{placement:"center",type:"success",close:!0})},error:function(a){toast.show(a,{placement:"center",type:"danger",close:!0})},info:function(a){toast.show(a,{placement:"center",type:"info",close:!0})},warning:function(a,t){toast.show(a,{placement:"center",type:"warning",close:!0})},show:function(a,t){new e.zui.Messager(a,t).show()},showLoading:function(){e("body").append('<div class="big-loading"><div class="loader"><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>')},hideLoading:function(){e("div").remove(".big-loading")}}}(jQuery,window),function(o){var a=window.Think={};a||o.error("ThinkPHP基础配置没有正确加载！"),a.parse_url=function(a){var t=a.match(/^(?:([a-z]+):\/\/)?([\w-]+(?:\.[\w-]+)+)?(?::(\d+))?([\w-\/]+)?(?:\?((?:\w+=[^#&=\/]*)?(?:&\w+=[^#&=\/]*)*))?(?:#([\w-]+))?$/i);return t||o.error("url格式不正确！"),{scheme:t[1],host:t[2],port:t[3],path:t[4],query:t[5],fragment:t[6]}},a.parse_str=function(a){var t,e=a.split("&"),i={};for(val in e)i[(t=e[val].split("="))[0]]=t[1];return i},a.parse_name=function(a,t){return t?(a.replace(/_([a-z])/g,function(a,t){return t.toUpperCase()}),a.replace(/[a-z]/,function(a){return a.toUpperCase()})):0===(a=a.replace(/[A-Z]/g,function(a){return"_"+a.toLowerCase()})).indexOf("_")&&(a=a.substr(1)),a},a.url=function(a,t,e){var i=this.parse_url(a),s=[],n={};return i.path||o.error("url格式错误！"),a=0===(a=i.path).indexOf("/")?(0==this.MODEL[0]&&o.error("该URL模式不支持使用路由!("+a+")"),"/"==a.substr(-1)&&(a=a.substr(0,a.length-1)),"/"+(a="/"==this.DEEP?a.substr(1):a.substr(1).replace(/\//g,this.DEEP))):((s=[(s=a.split("/")).pop(),s.pop(),s.pop()].reverse())[1]||o.error("ThinkPHP.Url("+a+")没有指定控制器"),s[0]&&(n[this.VAR[0]]=this.MODEL[1]?s[0].toLowerCase():s[0]),n[this.VAR[1]]=this.MODEL[1]?this.parse_name(s[1]):s[1],n[this.VAR[2]]=s[2].toLowerCase(),"?"+o.param(n)),"string"==typeof t?t=this.parse_str(t):o.isPlainObject(t)||(t={}),i.query&&o.extend(t,this.parse_str(i.query)),t&&(a+="&"+o.param(t)),0!=this.MODEL[0]&&(a=a.replace("?"+(s[0]?this.VAR[0]:this.VAR[1])+"=","/").replace("&"+this.VAR[1]+"=",this.DEEP).replace("&"+this.VAR[2]+"=",this.DEEP).replace(/(\w+=&)|(&?\w+=$)/g,"").replace(/[&=]/g,this.DEEP),!1!==e&&(e=e||this.MODEL[2].split("|")[0])&&(a+="."+e)),a=this.APP+a},a.setValue=function(a,t){var e,i,s=a.substr(0,1),n=0;if(""!==t)if((e=o("#"===s||"."===s?a:"[name='"+a+"']")).eq(0).is(":radio"))e.filter("[value='"+t+"']").each(function(){this.checked=!0});else if(e.eq(0).is(":checkbox"))for(o.isArray(t)?i=t:(i=new Array)[0]=t,n=0,len=i.length;n<len;n++)e.filter("[value='"+i[n]+"']").each(function(){this.checked=!0});else e.val(t)}}(jQuery),function(d,a,e){var c=function(a,r){var t=2<arguments.length&&arguments[2]!==e?arguments[2]:"",l="/admin/attachment/lists?page="+a+"&driver=tcvod&type="+r+"&keyword="+(t=t||"");d.get(l,function(a){if(a.code){var o="";d.each(a.data.data,function(a,t){var e="background-image: url("+t.url+");",i=t.attachment,s=t.filename,n=t.file_id;"image"==r&&(o+='<div class="item" data-type="'+r+'" style="'+e+'" data-id='+t.id+' data-url="'+l+'" data-filename="'+s+'" data-file-id="'+n+'">  <div class="name text-ellipsis">'+t.filename+'</div>  <div class="mask">      <i class="icon icon-check"></i>  </div>  <span class="del">     <span class="wi wi-delete2"></span>  </span></div>'),"audio"==r&&(o+='<div class="item" data-type="'+r+'" data-id='+t.id+' data-url="'+i+'" data-filename="'+s+'">  <img src="/static/common/images/icon-voice.png" alt="'+s+'" />  <div class="time">fileID：'+t.file_id+'</div>  <div class="name text-ellipsis">'+t.filename+'</div>  <div class="mask">      <i class="icon icon-check"></i>  </div>  <span class="del">     <span class="wi wi-delete2"></span>  </span></div>'),"video"==r&&(o+='<div class="item" data-type="'+r+'" data-id='+t.id+' data-url="'+i+'" data-filename="'+s+'">  <img src="/static/common/images/icon-video.png" alt="'+s+'" />  <div class="time">fileID：'+t.file_id+'</div>  <div class="name text-ellipsis">'+t.filename+'</div>  <div class="mask">      <i class="icon icon-check"></i>  </div>  <span class="del">     <span class="wi wi-delete2"></span>  </span></div>')}),d(".material-body .lists").html(o)}d(".pager").pager({page:a.data.current_page,recTotal:a.data.total,recPerPage:a.data.per_page,maxNavCount:5})})};d.muu.vodUpload=function(){var a=new TcVod.default({getSignature:getSignature}).upload({mediaFile:mediaFile});a.on("media_upload",function(a){console.log(a),uploaderInfo.isVideoUploadSuccess=!0}),a.on("media_progress",function(a){console.log(a.percent)}),a.done().then(function(a){}).catch(function(a){console.log(a)})},d.muu.buildVodUploadModal=function(i,l,a){l=l||"image",a=a||"button";var t="";console.log(l),d(".material-body .lists").html('<p class="loading">加载中...</p>'),"image"==l&&(t='<form action="" class="form-horizontal clearfix form-inline role="form">               <div class="progress-box pull-left"></div>               <div class="pull-right btn-uploader">                  <uploader-btn> 上传图片                  <input type="file" class="upload-btn" accept="image/*" value="上传图片" />                  </uploader-btn>\n               </div>\n            </form>'),"audio"==l&&(t='<form action="" class="form-horizontal clearfix form-inline role="form">               <div class="progress-box pull-left"></div>               <div class="pull-right btn-uploader">                  <uploader-btn> 上传音频                    <input type="file" class="upload-btn" accept="audio/*" value="上传音频" />                  </uploader-btn>\n               </div>\n            </form>'),"video"==l&&(t='<form action="" method="get" class="form-horizontal clearfix form-inline role="form">               <div class="progress-box pull-left"></div>               <div class="pull-right btn-uploader">                  <uploader-btn> 上传视频                    <input type="file" class="upload-btn" accept="video/*" value="上传视频" />                  </uploader-btn>\n               </div>\n            </form>');var s,e='<div id="material-'+l+'-Modal" class="uploader-vod-modal uploader-'+l+'-vod-modal modal fade" aria-hidden="true">\n   <div class="modal-dialog modal-lg">\n       <div class="modal-content ">\n           <div class="modal-header">\n               <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>\n               <h4 class="modal-title">云点播媒体资源</h4>           </div>\n           <div class="modal-body material-content clearfix">\n               <div class="material-head">';e+=t,e+='</div>\n               <div class="material-body">                    <div class="lists '+l+'-container"></div>                    <div class="attachment-page">                       <ul id="attachmentPage" data-ride="pager" class="pager" data-elements="prev,nav,next,page_of_total_text">                           <span class="loading">加载中...</span>                       </ul>                   </div>               </div>           </div>\n           <div class="modal-footer" id="material-footer">\n               <div id="btn-select">\n                   <span class="btn btn-primary btn-submit">确认</span>\n                   <span class="btn btn-default" data-dismiss="modal">取消</span>\n               </div>\n           </div>\n       </div>\n   </div>\n</div>',0<d("#material-"+l+"-Modal.uploader-"+l+"-vod-modal").length||d("body").append(e),d("#material-"+l+"-Modal.uploader-"+l+"-vod-modal").modal(),d("#material-"+(s=l)+"-Modal").off("shown.zui.modal").on("shown.zui.modal",function(){c(1,s)}),d("#material-"+s+"-Modal .pager").off("onPageChange").on("onPageChange",function(a,t,e){var i=d('[name="keyword"]').val();t.page!==e.page&&c(t.page,s,i)}),d(".uploader-vod-modal .material-head").off("change").on("change",'input[type="file"]',function(){var r=this.files[0],a=new TcVod.default({getSignature:function(){var t="";return d.ajax({url:"/api/vod/sign",async:!1,type:"GET",success:function(a){t=a},error:function(a,t,e){alert("签名错误")}}),t}}).upload({mediaFile:r});a.on("media_upload",function(a){}),a.on("media_progress",function(a){var t=a.percent,e=d(".material-head .progress-box"),i=e.find(".progress .progress-bar");i.length||(i=d('<div class="progress">               <div class="progress-bar" role="progressbar" aria-valuenow="40" aria-valuemin="0" aria-valuemax="100" style="width: 0%">                   <span class="sr-only">0% Complete (success)</span>               </div>            </div>            <strong><span class="progressbar-value">0</span>%</strong>').appendTo(e).find(".progress-bar"));var s=Math.round(100*t);i.css("width",s+"%"),e.find(".progressbar-value").text(s)}),a.done().then(function(a){var t,e,i,s,n,o;d(".material-head .progress-box").html(""),t=a,e=l,s=(i=r).name,n=s.lastIndexOf("."),o=s.substr(n+1),d.ajax({url:"/admin/attachment/edit",data:{filename:i.name,attachment:t.video.url,type:e,mime:i.type,size:i.size,ext:o,driver:"tcvod",file_id:t.fileId},type:"POST",success:function(a){c(1,e)},error:function(a,t,e){alert("写入数据错误")}})}).catch(function(a){console.log(a)})}),d(".uploader-vod-modal .material-body").off("click").on("click",".item",function(a){var t=a.target.tagName.toLowerCase(),e=d(this);if("span"==t){if(1==confirm("确认删除该资源？")){var i=e.data("id");d.ajax({url:"/admin/attachment/del",data:{id:i},type:"POST",success:function(a){c(1,l)},error:function(a,t,e){alert("Deletion Failed")}})}}else e.hasClass("active")?(e.find(".mask").css("display","none"),e.removeClass("active")):(e.find(".mask").css("display","block"),e.addClass("active"))}),d(".uploader-vod-modal .modal-footer").off("click").on("click",".btn-submit",function(a){a.stopImmediatePropagation();var t="";d(".uploader-vod-modal .lists .item.active").each(function(){var a=d(this);t=a.data("url")});var e=d(i).parent().parent();"image"==l&&e.next().find("img").attr("src",t),e.find("input.attach").val(t),d(this).parents(".uploader-vod-modal").find('[data-dismiss="modal"]').click()})}}(jQuery,window,void 0);